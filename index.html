<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="static/css/index.css">
</head>

<body> 
    <div class="myVideo">

        <video id="video1">
            <source src="http://www.w3school.com.cn/example/html5/mov_bbb.mp4" type="video/mp4" />
        </video>
        <div class="loading" id="loading">
            loading......
        </div>
        <div class="controls">
            <button class="pausebut" id="pause" onclick="playPause()" disabled>播放/暂停</button>
            <ul class="lanren">
                <li><span id="totleTime"></span>/<span id="title">0</span>
                    <div class="scale_panel">
                        <span class="r">100</span>0
                        <div class="scale" id="bar">
                   1         <!--蓝色进度条-->
                            <div></div>
                            <span id="btn"></span>
                        </div>
                    </div>
                </li>
            </ul>
        </div>

    </div>
    <h1 id="log">

    </h1>
    <script>
        // var video1 = document.getElementById("video1");
        var scale = function (btn, bar, title) {
            this.btn = document.getElementById(btn);//拖动的方块
            this.bar = document.getElementById(bar);//整个bar
            this.title = document.getElementById(title);//当前百分比title
            this.step = this.bar.getElementsByTagName("div")[0];//蓝色进度条
            this.video1 = document.getElementById("video1");//视频
            this.loading = document.getElementById("loading");//loading
            this.pause = document.getElementById("pause");//暂停按钮 
            this.totleTime=document.getElementById("totleTime")//总时间
            this.canMove = true;//是否可以拖动
            this.log = document.getElementById("log");//log输出
            this.isfirstloading = true;//是否是第一次播放
            this.init();
        };
        scale.prototype = {
            init: function () {
                var f = this, g = document, b = window, m = Math;
                //video准备完成
                f.video1.addEventListener('loadedmetadata', function () {
                    console.log("ready2");
                    f.totleTime.innerHTML= f.video1.duration;
                    //正在播放
                    f.video1.addEventListener('timeupdate', function () {
                        timeupdate();
                    })
                    //可以播放 
                    f.video1.addEventListener('canplaythrough', function () {
                        f.log.innerHTML += "a";
                        f.pause.disabled=false;
                    });
                    //权限控制进度条是否可拖动
                    if (f.canMove) {
                        f.btn.onmousedown = function (e) {
                            var x = (e || b.event).clientX;
                            var l = this.offsetLeft;
                            var max = f.bar.offsetWidth - this.offsetWidth;
                            //按钮拖动
                            g.onmousemove = function (e) {
                                var thisX = (e || b.event).clientX;
                                var to = m.min(max, m.max(-2, l + (thisX - x)));
                                f.btn.style.left = to + 'px';
                                f.ondrag(m.round(m.max(0, to / max) * 100), to);
                                b.getSelection ? b.getSelection().removeAllRanges() : g.selection.empty();
                                f.btn.onmouseup = function (e) {
                                    f.setCurTime(m.round(m.max(0, to / max) * 100));
                                    video1.play();
                                }
                                f.video1.pause();

                            }
                            g.onmouseup = new Function('this.onmousemove=null');
                        }
                    }
                    //按钮点击暂停
                    f.pause.onclick = function () {
                        // f.isplay=true;
                        if(f.isfirstloading){
                            f.loading.style.opacity = 1;
                            var timer = setInterval(function () {
                                var currentTime = f.video1.currentTime; // 检测当前的播放时间

                                if (currentTime > 0) {
                                    f.loading.style.opacity = 0;
                                    clearInterval(timer);
                                }
                            }, 100);
                        }
                        f.isfirstloading=false;
                        if (f.video1.paused)
                            f.video1.play();
                        else
                            f.video1.pause();
                    }
                })

                // f.video1.addEventListener('loadedmetadata',function(){
                //     console.log("loadedmetadata")
                // })
                function timeupdate() {
                    var persent = parseInt(f.video1.currentTime / f.video1.duration * 100);
                    var x = parseInt(f.bar.offsetWidth * persent / 100);
                    // console.log(x);
                    f.ondrag(persent, x);
                    f.btn.style.left = x + 'px';
                    // f.log.innerHTML+=f.video1.readyState;
                };

            },
            //滚动条进度
            ondrag: function (pos, x) {
                // console.log(x)
                this.step.style.width = Math.max(0, x) + 'px';
                this.title.innerHTML = pos + '%';
            },
            //按百分比设置当前视频时间
            setCurTime: function (persent) {
                video1.currentTime = video1.duration * persent / 100;
            }
        }
        new scale('btn', 'bar', 'title');
    </script>
</body>

</html> ·